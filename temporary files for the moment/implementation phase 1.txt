// ============================================
// BLOG PAGE - ENHANCED PINTEREST META
// src/app/blog/[slug]/page.tsx
// ============================================

export async function generateMetadata({ params }: PageProps): Promise<Metadata> {
  const { slug } = params;
  const post = await getBlogPost(slug);
  
  if (!post) {
    return {
      title: 'Post Not Found - Mirelle',
      description: 'The blog post you are looking for does not exist.',
      robots: { index: false, follow: false },
    };
  }

  const canonicalUrl = post.canonical || `https://mirelleinspo.com/blog/${slug}`;
  const imageUrl = post.image ? `https://mirelleinspo.com${post.image}` : 'https://mirelleinspo.com/og-default.png';
  const imageAltText = post.imageAlt || post.title;
  const keywords = post.tags?.length 
    ? post.tags.join(', ')
    : 'nail art, nail care, nail trends, manicure tips, nail design';
  
  // ðŸ†• ENHANCED: Extract first tag for Pinterest category
  const primaryTag = post.tags?.[0] || 'nail art';
  
  return {
    title: `${post.title} | Mirelle`,
    description: post.excerpt || `Discover ${post.title} - expert nail tips, trends, and tutorials from Mirelle.`,
    keywords,
    authors: [{ name: post.author || 'Mirelle' }],
    creator: post.author || 'Mirelle',
    publisher: 'Mirelle',
    alternates: { canonical: canonicalUrl },
    robots: {
      index: true,
      follow: true,
      nocache: false,
      googleBot: {
        index: true,
        follow: true,
        'max-video-preview': -1,
        'max-image-preview': 'large',
        'max-snippet': -1,
      },
      bingBot: {
        index: true,
        follow: true,
        'max-image-preview': 'large',
      },
    },
    openGraph: {
      title: `${post.title} | Mirelle`,
      description: post.excerpt || `Discover ${post.title} - expert nail inspiration from Mirelle.`,
      type: 'article',
      url: canonicalUrl,
      siteName: 'Mirelle',
      locale: 'en_US',
      images: [{
        url: imageUrl,
        width: post.imageWidth || 1200,
        height: post.imageHeight || 630,
        alt: imageAltText,
        type: 'image/jpeg',
      }],
      publishedTime: post.date,
      modifiedTime: post.dateModified || post.updatedDate || post.date,
      authors: [post.author || 'Mirelle'],
      section: post.category || 'Nail Care',
      tags: post.tags || [],
    },
    twitter: {
      card: 'summary_large_image',
      title: `${post.title} | Mirelle`,
      description: post.excerpt || `Discover ${post.title} - expert nail inspiration from Mirelle.`,
      images: [imageUrl],
      creator: '@mirelleinspo',
      site: '@mirelleinspo',
    },
    other: {
      'article:published_time': post.date,
      'article:modified_time': post.dateModified || post.updatedDate || post.date,
      'article:author': post.author || 'Mirelle',
      'article:section': post.category || 'Nail Care',
      'article:tag': post.tags?.join(', ') || '',
      ...(post.wordCount && { 'article:word_count': post.wordCount.toString() }),
      
      // ðŸ†• MAXIMUM PINTEREST OPTIMIZATION
      'pin:description': post.excerpt || `Discover ${post.title} - expert nail inspiration from Mirelle.`,
      'pin:media': imageUrl,
      'pinterest-rich-pin': 'true',
      
      // ðŸ†• Pinterest-specific image optimization
      'og:image:width': (post.imageWidth || 1200).toString(),
      'og:image:height': (post.imageHeight || 630).toString(),
      'og:image:alt': imageAltText,
      'og:image:type': 'image/jpeg',
      
      // ðŸ†• Pinterest category targeting (helps Pinterest algorithm)
      'article:publisher': 'https://www.pinterest.com/mirelle_inspo',
      'pinterest:category': primaryTag,
      
      // ðŸ†• Pinterest board suggestions (if user saves)
      'pinterest:board_suggestion': post.category || 'Nail Art Ideas',
      
      // ðŸ†• Enhanced social sharing
      'og:see_also': canonicalUrl,
      
      // ðŸ†• Pinterest-friendly reading time
      ...(post.readingTime && { 'twitter:label1': 'Reading time', 'twitter:data1': post.readingTime }),
      ...(post.tags?.length && { 'twitter:label2': 'Filed under', 'twitter:data2': primaryTag }),
    },
  };
}

// ============================================
// SHOP PAGE - ENHANCED PINTEREST SHOPPING META
// src/app/shop/[category]/page.tsx
// ============================================

export async function generateMetadata({
  params,
}: {
  params: Promise<{ category: string }>;
}): Promise<Metadata> {
  const { category } = await params;
  const categoryData = getCategoryData(category);

  if (!categoryData) {
    return { title: 'Category Not Found' };
  }

  const seo = categoryData.seo;
  const keywordsArray = Array.isArray(seo.keywords) 
    ? seo.keywords 
    : seo.keywords.split(',').map((k: string) => k.trim());
  
  const ogImageUrl = seo.ogImage || `https://mirelleinspo.com${categoryData.heroImage}`;
  
  // ðŸ†• Get products for aggregate data
  const products = await getCategoryProducts(category);
  const productCount = products.length;
  
  // ðŸ†• Calculate price range for Pinterest shopping
  const prices = products
    .map(p => parseFloat(p.price.toString().replace('$', '')))
    .filter(p => !isNaN(p) && p > 0);
  const minPrice = prices.length > 0 ? Math.min(...prices).toFixed(2) : '3.99';
  const maxPrice = prices.length > 0 ? Math.max(...prices).toFixed(2) : '29.99';

  return {
    title: seo.title,
    description: seo.description,
    keywords: keywordsArray,
    openGraph: {
      title: seo.title,
      description: seo.description,
      type: 'website',
      url: `https://mirelleinspo.com/shop/${category}`,
      siteName: 'Mirelle',
      locale: 'en_US',
      images: [{
        url: ogImageUrl,
        alt: seo.title,
        width: 1200,
        height: 630,
      }],
    },
    twitter: {
      card: 'summary_large_image',
      title: seo.title,
      description: seo.description,
      images: [ogImageUrl],
    },
    alternates: {
      canonical: `https://mirelleinspo.com/shop/${category}`,
    },
    robots: {
      index: true,
      follow: true,
      nocache: false,
      googleBot: {
        index: true,
        follow: true,
        'max-image-preview': 'large',
        'max-snippet': -1,
      },
      bingBot: {
        index: true,
        follow: true,
        'max-image-preview': 'large',
      },
    },
    other: {
      // ðŸ†• MAXIMUM PINTEREST SHOPPING OPTIMIZATION
      'pin:description': seo.description,
      'pin:media': ogImageUrl,
      'pinterest-rich-pin': 'true',
      
      // ðŸ†• Product catalog meta
      'product:category': categoryData.name,
      'product:availability': 'in stock',
      'product:condition': 'new',
      'product:retailer': 'Amazon',
      
      // ðŸ†• Price range for Pinterest Product Pins
      'product:price:amount': minPrice,
      'product:price:currency': 'USD',
      'product:price_range:min': minPrice,
      'product:price_range:max': maxPrice,
      
      // ðŸ†• Inventory signals
      'product:item_group_id': category,
      'product:plural_title': `${categoryData.name} Collection`,
      
      // ðŸ†• Pinterest shopping category
      'og:type': 'product.group',
      'pinterest:category': 'Beauty > Nail Care',
      
      // ðŸ†• Collection size (helps Pinterest rank)
      'og:product:count': productCount.toString(),
      
      // ðŸ†• Enhanced image data
      'og:image:width': '1200',
      'og:image:height': '630',
      'og:image:alt': seo.title,
      'og:image:type': 'image/jpeg',
      
      // ðŸ†• Pinterest board suggestion
      'pinterest:board_suggestion': categoryData.name,
      
      // ðŸ†• Shopping-specific labels
      'twitter:label1': 'Products',
      'twitter:data1': `${productCount} items`,
      'twitter:label2': 'Price Range',
      'twitter:data2': `$${minPrice} - $${maxPrice}`,
    },
  };
}

// ============================================
// LAYOUT - ENHANCED GLOBAL PINTEREST META
// src/app/layout.tsx
// ============================================

// UPDATE the metadata object's "other" property:

export const metadata: Metadata = {
  // ... existing metadata ...
  
  other: {
    'distribution': 'global',
    'rating': 'general',
    'coverage': 'worldwide',
    'target': 'all',
    'audience': 'all',
    'language': 'en-US',
    'classification': 'Beauty, Fashion, Nail Art, Tutorials, DIY, Lifestyle',
    'referrer': 'always',
    'revisit-after': '7 days',
    
    // ðŸ†• ENHANCED PINTEREST GLOBAL META
    'pinterest-rich-pin': 'true',
    'pinterest:partner': 'true',
    'pinterest:domain_verify': 'claimed', // Since you already claimed
    
    // ðŸ†• Global Pinterest catalog hints
    'og:site_name': 'MirellÃ©',
    'og:locale': 'en_US',
    'og:locale:alternate': 'en_GB',
  },
  
  // ... rest of metadata ...
};

// ALSO ADD to organizationSchema in layout.tsx (around line 127):

const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "@id": `${baseUrl}/#organization`,
  "name": "MirellÃ©",
  "alternateName": "Mirelle",
  "url": baseUrl,
  "logo": {
    "@type": "ImageObject",
    "url": `${baseUrl}/apple-touch-icon.png`,
    "width": 512,
    "height": 512
  },
  "description": "Expert nail art inspiration, tutorials, and seasonal beauty trends for modern women",
  "sameAs": [
    "https://www.pinterest.com/mirelle_inspo",
    "https://www.instagram.com/mirelle_inspo",
    "https://www.wikidata.org/wiki/mirelle_inspo",
    "https://x.com/mirelleinspo",
  ],
  
  // ðŸ†• ADD PINTEREST-SPECIFIC SCHEMA
  "image": `${baseUrl}/og-image.jpg`,
  "potentialAction": {
    "@type": "InteractAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "https://www.pinterest.com/pin/create/button/?url={url}&media={media}&description={description}",
      "actionPlatform": [
        "http://schema.org/DesktopWebPlatform",
        "http://schema.org/MobileWebPlatform"
      ]
    },
    "name": "Save to Pinterest"
  },
  
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "Customer Service",
    "url": `${baseUrl}/contact`
  },
  "areaServed": {
    "@type": "Place",
    "name": "Worldwide"
  },
  "audience": {
    "@type": "Audience",
    "audienceType": "Global",
    "geographicArea": {
      "@type": "Place",
      "name": "Worldwide"
    }
  }
};
