// src/app/inspo/[design]/page.tsx
import { Metadata } from 'next';
import { notFound } from 'next/navigation';
import InspoClient from '@/components/Inspo/InspoClient';
import {
  getDesignData,
  getDesignImages,
  getAllDesignSlugs,
  getRelatedDesigns,
} from '@/lib/inspo';
import { generateFAQSchema, generateArticleSchema, generateHowToSchema } from '@/lib/faqSchemas';

// Generate static params for all design pages
export async function generateStaticParams() {
  const slugs = getAllDesignSlugs();
  return slugs.map((slug) => ({
    design: slug,
  }));
}

// Generate metadata for each design page
export async function generateMetadata({
  params,
}: {
  params: Promise<{ design: string }>;
}): Promise<Metadata> {
  const { design } = await params;
  const designData = getDesignData(design);
  
  if (!designData) {
    return {
      title: 'Design Not Found',
    };
  }
  
  const seo = designData.seo;
  const keywordsArray = Array.isArray(seo.keywords) 
    ? seo.keywords 
    : seo.keywords.split(',').map((k: string) => k.trim());
  
  const canonicalUrl = `https://mirelleinspo.com/inspo/${design}`;
  const imageUrl = designData.heroImage.startsWith('/')
    ? `https://mirelleinspo.com${designData.heroImage}`
    : designData.heroImage;
  
  return {
    title: seo.title,
    description: seo.description,
    keywords: keywordsArray,
    authors: [{ name: "Mirellé" }],
    creator: "Mirellé",
    publisher: "Mirellé",
    alternates: {
      canonical: canonicalUrl,
    },
    robots: {
      index: true,
      follow: true,
      googleBot: {
        index: true,
        follow: true,
        "max-video-preview": -1,
        "max-image-preview": "large",
        "max-snippet": -1,
      },
    },
    openGraph: {
      title: seo.title,
      description: seo.description,
      type: 'website',
      url: canonicalUrl,
      siteName: 'Mirellé',
      locale: 'en_US',
      images: [
        {
          url: imageUrl,
          alt: `${designData.displayName} winter nail designs 2025 inspiration gallery`,
          width: 1200,
          height: 630,
          type: 'image/webp',
        },
      ],
    },
    twitter: {
      card: 'summary_large_image',
      title: seo.title,
      description: seo.description,
      images: [imageUrl],
      creator: "@mirelleinspo",
      site: "@mirelleinspo",
    },
    other: {
      "pin:description": seo.description,
      "pin:media": imageUrl,
      "pinterest-rich-pin": "true",
      "og:image:width": "1200",
      "og:image:height": "630",
      "og:image:alt": `${designData.displayName} winter nail designs 2025 inspiration gallery`,
      "og:image:type": "image/webp",
      "article:publisher": "https://www.pinterest.com/mirelle_inspo",
      "pinterest:category": designData.displayName.toLowerCase(),
      "pinterest:board_suggestion": `${designData.displayName} Inspiration`,
      "og:see_also": canonicalUrl,
    },
  };
}

// Schema generation functions
function generateImageGallerySchema(designData: any, images: any[]) {
  return {
    '@context': 'https://schema.org',
    '@type': 'ImageGallery',
    '@id': `https://mirelleinspo.com/inspo/${designData.slug}#gallery`,
    name: `${designData.displayName} Winter Nail Design Gallery`,
    description: designData.seo.description,
    url: `https://mirelleinspo.com/inspo/${designData.slug}`,
    image: images.slice(0, 20).map(img => ({
      '@type': 'ImageObject',
      contentUrl: img.url.startsWith('/') ? `https://mirelleinspo.com${img.url}` : img.url,
      name: img.alt,
      description: img.alt,
      encodingFormat: 'image/webp',
    })),
  };
}

function generateCollectionPageSchema(designData: any, images: any[]) {
  return {
    '@context': 'https://schema.org',
    '@type': 'CollectionPage',
    '@id': `https://mirelleinspo.com/inspo/${designData.slug}#collection`,
    name: `${designData.displayName} Collection - Winter 2025`,
    description: designData.seo.description,
    url: `https://mirelleinspo.com/inspo/${designData.slug}`,
    numberOfItems: images.length,
    about: {
      '@type': 'Thing',
      name: designData.displayName,
      description: designData.description,
    },
    isPartOf: {
      '@type': 'WebSite',
      '@id': 'https://mirelleinspo.com/#website',
      name: 'Mirellé',
      url: 'https://mirelleinspo.com',
    },
  };
}

function generateBreadcrumbSchema(designData: any) {
  return {
    '@context': 'https://schema.org',
    '@type': 'BreadcrumbList',
    itemListElement: [
      {
        '@type': 'ListItem',
        position: 1,
        name: 'Home',
        item: 'https://mirelleinspo.com',
      },
      {
        '@type': 'ListItem',
        position: 2,
        name: 'Winter Nail Designs 2025',
        item: 'https://mirelleinspo.com/inspo',
      },
      {
        '@type': 'ListItem',
        position: 3,
        name: designData.displayName,
        item: `https://mirelleinspo.com/inspo/${designData.slug}`,
      },
    ],
  };
}

function generateWebPageSchema(designData: any) {
  return {
    '@context': 'https://schema.org',
    '@type': 'WebPage',
    '@id': `https://mirelleinspo.com/inspo/${designData.slug}#webpage`,
    name: designData.seo.title,
    description: designData.seo.description,
    url: `https://mirelleinspo.com/inspo/${designData.slug}`,
    primaryImageOfPage: {
      '@type': 'ImageObject',
      contentUrl: designData.heroImage.startsWith('/') 
        ? `https://mirelleinspo.com${designData.heroImage}` 
        : designData.heroImage,
      encodingFormat: 'image/webp',
    },
    datePublished: '2025-11-23T08:00:00+00:00',
    dateModified: new Date().toISOString(),
    isPartOf: {
      '@type': 'WebSite',
      '@id': 'https://mirelleinspo.com/#website',
      name: 'Mirellé',
    },
  };
}

function generateOrganizationSchema() {
  return {
    '@context': 'https://schema.org',
    '@type': 'Organization',
    '@id': 'https://mirelleinspo.com/#organization',
    name: 'Mirellé',
    url: 'https://mirelleinspo.com',
    logo: {
      '@type': 'ImageObject',
      url: 'https://mirelleinspo.com/logo.png',
    },
    sameAs: [
      'https://www.pinterest.com/mirelle_inspo',
      'https://www.instagram.com/mirelle',
      'https://twitter.com/mirelle',
    ],
  };
}

export default async function InspoDesignPage({
  params,
}: {
  params: Promise<{ design: string }>;
}) {
  const { design } = await params;

  const designData = getDesignData(design);
  const images = await getDesignImages(design);
  const relatedDesigns = getRelatedDesigns(design, 3);

  if (!designData) {
    notFound();
  }

  // Generate all schemas
  const imageGallerySchema = generateImageGallerySchema(designData, images);
  const collectionSchema = generateCollectionPageSchema(designData, images);
  const breadcrumbSchema = generateBreadcrumbSchema(designData);
  const webPageSchema = generateWebPageSchema(designData);
  const faqSchema = generateFAQSchema(designData);
  const articleSchema = generateArticleSchema(designData);
  const howToSchema = generateHowToSchema(designData);
  const organizationSchema = generateOrganizationSchema();

  // Breadcrumb items for component
  const breadcrumbItems = [
    { label: 'Winter 2025', href: '/inspo' }
  ];

  return (
    <>
      {/* Schema markup - ALL 8 TYPES */}
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{
          __html: JSON.stringify(imageGallerySchema),
        }}
      />

      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{
          __html: JSON.stringify(collectionSchema),
        }}
      />

      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{
          __html: JSON.stringify(breadcrumbSchema),
        }}
      />

      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{
          __html: JSON.stringify(webPageSchema),
        }}
      />

      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{
          __html: JSON.stringify(faqSchema),
        }}
      />

      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{
          __html: JSON.stringify(articleSchema),
        }}
      />

      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{
          __html: JSON.stringify(howToSchema),
        }}
      />

      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{
          __html: JSON.stringify(organizationSchema),
        }}
      />

      <InspoClient
        designData={designData}
        initialImages={images}
        relatedDesigns={relatedDesigns}
        breadcrumbItems={breadcrumbItems}
      />
    </>
  );
}
